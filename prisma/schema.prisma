datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String // Hashed
  name      String?
  role      String   @default("user") // "user", "admin", "moderator"
  image     String?
  
  // Account Recovery & Security
  emailVerifiedAt     DateTime?
  passwordResetToken  String?   @unique
  passwordResetExpires DateTime?
  
  // Activity Tracking
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  lastLoginAt  DateTime?
  
  // Relations
  securityLogs SecurityLog[]
}

model SecurityLog {
  id        String   @id @default(cuid())
  event     String   // "login_attempt", "failed_auth", "rate_limit_violation", "unauthorized_access", etc.
  severity  String   @default("info") // "info", "warning", "critical"
  userId    String?
  email     String?
  ip        String?
  userAgent String?
  details   String? // JSON string for SQLite compatibility
  resolved  Boolean  @default(false)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)
}

model SystemFlag {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}
